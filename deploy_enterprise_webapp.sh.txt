#!/bin/bash
# =========================================================
# Enterprise Web Application Deployment on AWS
# Project: Enterprise Web Application Deployment on AWS
# Author: Eagle
# =========================================================

# -------------------------
# Variables - Modify as needed
# -------------------------
WEB_USER="ec2-user"
APP_DIR="/var/www/html"
S3_BUCKET="project1-enterprise-static-bucket"
RDS_ENDPOINT="enterprise-db.xxxxx.us-east-1.rds.amazonaws.com"
RDS_USER="admin"
RDS_PASSWORD="YourRdsPassword"

# -------------------------
# Update & Install Web Server
# -------------------------
echo "Updating system and installing Apache..."
sudo yum update -y
sudo yum install -y httpd
sudo systemctl start httpd
sudo systemctl enable httpd

# -------------------------
# Deploy Static Website
# -------------------------
echo "Deploying static website from S3 bucket..."
aws s3 sync s3://$S3_BUCKET $APP_DIR --region us-east-1
sudo chown -R $WEB_USER:$WEB_USER $APP_DIR
sudo chmod -R 755 $APP_DIR

# -------------------------
# Configure Test HTML Page
# -------------------------
echo "Creating test index.html..."
echo "<h1>Enterprise Web Application Deployed Successfully</h1>" | sudo tee $APP_DIR/index.html

# -------------------------
# Install MySQL Client for RDS connectivity
# -------------------------
echo "Installing MySQL client..."
sudo yum install -y mysql

# -------------------------
# Test RDS Connectivity
# -------------------------
echo "Testing RDS connection..."
mysql -h $RDS_ENDPOINT -u $RDS_USER -p$RDS_PASSWORD -e "SHOW DATABASES;"

# -------------------------
# Firewall & Security
# -------------------------
echo "Configuring Security Groups (already applied via AWS console)..."

# -------------------------
# Final Message
# -------------------------
echo "Deployment script completed successfully!"
echo "Visit your EC2 public IP or ALB DNS to verify the web application."

